---
title: "Correlation between typological frequency, borrowability and stability"
author: "Carlos Silva"
date: "2023-06-02"
output:
  github_document:
    toc: true
---


# Preparation

## Loading packages

```{r}
library(tidyverse)
library(PMCMRplus)
library(ggpubr)
library(rstatix)
library(stats)
```

## Getting ordinal data

Ordinal data was generated by ranking the percentage values of stability, borrowability and typological frequency from 1 to 19. Duplicate values summed and averaged in the ranking.

1) Cross linguistic frequency

```{r}

order_typ <- c(1,
2	,
3	,
4	,
5	,
5	,
7	,
8	,
9	,
10	,
11.5	,
11.5	,
13	,
14	,
15	,
16	,
17	,
18	,
19)
consonant <- c("m",
             "k",
             "p",
             "n",
             "t",
             "l",
             "s",
             "b",
             "g",
             "d",
             "f",
             "r",
             "ɲ",
             "t̠ʃ",
             "z",
             "v",
             "ɾ",
             "ʒ",
             "ʎ")
df_typ <- data.frame(order_typ, consonant)
```

2) Borrowability

```{r}
order_bor <- c(1	,
2	,
3	,
4	,
5	,
6	,
6	,
8	,
9	,
10	,
11	,
12	,
13	,
14.5	,
14.5	,
16	,
17	,
18	,
19)
consonant <- c("f",
              "g",
              "t̠ʃ",
              "b",
              "z",
              "v",
              "d",
              "r",
              "p",
              "l",
              "s",
              "ʒ",
              "ɾ",
              "ɲ",
              "k",
              "ʎ",
              "t",
              "n",
              "m")
df_bor <- data.frame(order_bor, consonant)
```

3) Stability values


```{r}
order_sta <- c(2,
2	,
2	,
2	,
5	,
7 ,
7	,
7	,
8	,
10	,
11	,
12	,
13	,
14	,
15	,
16	,
17	,
18	,
19)
consonant <- c("t",
               "p",
               "n",
               "m",
               "f",
               "b",
               "k",
               "g",
               "d",
               "z",
               "s",
               "l",
               "r",
               "t̠ʃ",
               "ɾ",
               "ɲ",
               "ʒ",
               "ʎ",
               "v")
df_sta <- data.frame(order_sta, consonant)

```

## Creating dataframes

### For non-parametric tests


Long format with joint groups
```{r}

df_friedman <- left_join(df_sta, df_bor, by="consonant")

order_df <- left_join(df_friedman, df_typ, by="consonant")
head(order_df)


df_long <- order_df %>% gather(key = "conditions", 
                         value = "order", order_bor, order_sta, order_typ)

head(df_long)

```

### For Spearman's rank correlation coefficient

Large format and separated groups
```{r}

df_sta_bor <- left_join(df_sta, df_bor, by="consonant")
df_sta_typ <- left_join(df_sta, df_typ, by="consonant")

```


Converting to long format
```{r}
  
sta_bor_long <- df_sta_bor %>% gather(key = "conditions", 
                                    value = "order", order_bor, order_sta)
sta_typ_long <- df_sta_typ %>% gather(key = "conditions", 
                                      value = "order", order_typ, order_sta)
```

# Non-parametric tests


Statistical summary

```{r}

df_long %>% group_by(conditions) %>%  summarise(n = n(), mean = mean(order), 
                                               sd = sd(order))
```

A first plot 

```{r}
ggplot(df_long, aes(x = consonant, y = order)) + geom_boxplot(outlier.shape = NA) + 
  geom_jitter(width = 0.2) + theme(legend.position="top")
```


## Friedman test

```{r}

friedman.test(y = df_long$order, groups = df_long$conditions, blocks = df_long$consonant)

df_long %>% friedman_effsize(order ~ conditions | consonant)
```

## Conover's all-pairs test

```{r}

frdAllPairsConoverTest(
  y = df_long$order, 
  groups = df_long$conditions, 
  blocks = df_long$consonant, 
  p.adjust.method = "bonf")
```

## Durbin's all-pairs test

```{r}
durbinAllPairsTest(
  y      = df_long$order, 
  groups = df_long$conditions, 
  blocks = df_long$consonant,
  p.adjust.method = "holm")
```

## Spearman’s Correlation Coefficient

### Stability~Borrowability

```{r}
cor.test(x=df_sta_bor$order_bor, 
         y=df_sta_bor$order_sta, 
         method = 'spearman')
```

### Stability~Typological frequency

```{r}
cor.test(x=df_sta_typ$order_typ, 
         y=df_sta_typ$order_sta, 
         method = 'spearman')
```


# Plots

## Box plots


Stability vs typological frequency

```{r}
ggplot(sta_typ_long, aes(x = consonant, y = order)) + geom_boxplot(outlier.shape = NA) + 
  geom_jitter(width = 0.2) + theme(legend.position="top")

```

Stability vs borrowability

```{r}
ggplot(sta_bor_long, aes(x = consonant, y = order)) + geom_boxplot(outlier.shape = NA) + 
  geom_jitter(width = 0.2) + theme(legend.position="top")
```

## Bump chart

```{r}

ggplot(data = df_long, aes(x = conditions, y = order, group = consonant)) +
  geom_line(aes(color = consonant, alpha = 1), size = 1) +
  geom_point(aes(color = consonant, alpha = 1), size = 2,  alpha = 0.8) +
  scale_y_reverse(breaks = 1:nrow(df_long)) +
  scale_alpha(guide = 'none') +
  #theme(legend.position="bottom") +
  theme( panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank())
    #theme(panel.background = element_rect(color="white")) +
    #theme(plot.background  = element_rect(color="white")) +
    #theme(panel.border     = element_rect(color="white")) +
    #theme(strip.background = element_rect(color="white"))
```