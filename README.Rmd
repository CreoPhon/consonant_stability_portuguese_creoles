---
title: "Supplementary materials for: Consonant stability in Portuguese-based creoles"
author: "Carlos Silva and Steven Moran"
date: "(`r format(Sys.time(), '%d %B, %Y')`)"
output:
  github_document:
    toc: true
bibliography: 'bibliography.bib'
---
  
# Overview
  
Supplementary materials for [Consonant Stability in Portuguese-based creoles](https://www.overleaf.com/project/60cdac0dd5871295e0f608fc). Silva, Carlos and Steven Moran. Work in progress.

In this report, we use R [@R] and the following packages [@tidyverse;@knitr].

```{r, message=FALSE}
library(tidyverse)
library(knitr)
```

First load the dataset.

```{r, message=FALSE}
database <- read_csv('database.csv')
```

The data look like this.

```{r}
database %>% head() %>% kable()
```

# Creole stability

Which creoles in the sample are more or less stable overall?

First, we prepare the data for analysis.

```{r}
creole_stability <- database %>% select(language, place_stability, manner_stability)
creole_stability$place_stability = as.numeric(creole_stability$place_stability)
creole_stability$manner_stability = as.numeric(creole_stability$manner_stability)
```

Next, we calculate the stability measure for each creole.

```{r}
global_creole_stability <- mutate(creole_stability, global_stability = (place_stability + manner_stability)/2)

final_results <- global_creole_stability %>% group_by(language) %>% summarize(m = mean(global_stability, na.rm = TRUE))
```

Lastly, we plot the results.

```{r}
region <- c("GG", "UG", "UG", "UG", "UG", "UG", "NI", "NI", "GG", "UG", "SI", "NI", "SA", "GG", "GG", "SI")

final_results_region <- cbind(final_results, region)

ggplot(final_results_region) + 
  geom_bar(aes(x = m, y = reorder(language, m), fill = region), 
           stat = "identity", show.legend = FALSE) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())
```


# Segment stability

Which segments are the most stable across creoles in the language sample?

First we prepare the data.

```{r}
data_by_phoneme <- database %>% select(lexifier_phoneme, place_stability, manner_stability)
data_by_phoneme$place_stability = as.numeric(data_by_phoneme$place_stability)
data_by_phoneme$manner_stability = as.numeric(data_by_phoneme$manner_stability)
```

Then we calculate stability of place and manner for each phoneme.

```{r}
place_results <- data_by_phoneme %>% group_by(lexifier_phoneme) %>% summarize(mplace = mean(place_stability, na.rm = TRUE))

manner_results <- data_by_phoneme %>% group_by(lexifier_phoneme) %>% summarize(mmanner = mean(manner_stability, na.rm = TRUE))

consonant_stability <- left_join(place_results, manner_results, by = "lexifier_phoneme")

class <- c("nasal", "rhotic", "lateral", "fricative", "stop", "stop", "fricative", "stop", "stop", "lateral", "nasal", "nasal", "stop", "rhotic", "fricative", "stop", "affricate", "fricative", "fricative")

consonant_stability_class <- cbind(consonant_stability, class)
```

Next, we plot the results.

```{r}
# TODO: fix the class "dots"
ggplot(consonant_stability, aes(y = mmanner, x = mplace, label = lexifier_phoneme, color=class)) +
  geom_point(position= "dodge") + 
  geom_text(aes(label=lexifier_phoneme), hjust=3, vjust=0) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())
```

Here is an alternative view for the global results.

```{r}
# TODO: add x-axis text, legend text, change color?
consonant_global_stability <- mutate(consonant_stability_class, mglobal = (mmanner + mplace)/2)

ggplot(consonant_global_stability) + geom_bar(aes(x = mglobal, y = reorder(lexifier_phoneme, mglobal), fill = class), stat = "identity", show.legend = TRUE) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())
```


# Word position

Next we ask, does word position influence stability?

First, data prepartion.

```{r}
data_by_position <- database %>% select(position, lexifier_phoneme, place_stability, manner_stability) %>% mutate(position = tolower(position))

data_by_position$place_stability = as.numeric(data_by_position$place_stability)

data_by_position$manner_stability = as.numeric(data_by_position$manner_stability)
```

Next, calculate stability for each segment according to its word position.

```{r}
position_stability <- mutate(data_by_position, global_stability = (place_stability + manner_stability)/2)

position_results <- position_stability %>% group_by(position, lexifier_phoneme) %>% summarize(m = mean(global_stability, na.rm = TRUE))
```

And plot the results for all segments.

```{r}
# TODO: flip horizontally, change colors
position_results$position <- factor(position_results$position, levels = c('word-initial', 'word-medial', 'word-final'))

ggplot(position_results, aes(x= lexifier_phoneme, y=m, fill=position)) + 
  geom_col(position = position_dodge2(width= 0.9, preserve = "single")) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())
```

Plot the results for segments that show differences.

```{r}
# TODO: update what we show, flip horizontally, change colors
position_results1 <- position_results %>% pivot_wider(names_from = position, values_from = m)

different_position <- subset(position_results1, position_results1$`word-initial` != position_results1$`word-medial` | position_results1$`word-final` != position_results1$`word-medial`)

different_position_results <- different_position %>% pivot_longer(c(`word-initial`, `word-medial`, `word-final`), names_to = "position", values_to = "m")

different_position_results$position <- factor(different_position_results$position, levels = c('word-initial', 'word-medial', 'word-final'))

ggplot(different_position_results, aes(x= lexifier_phoneme, y=m, fill=position)) + 
  geom_col(position = position_dodge2(width= 0.9, preserve = "single"))
```

# References
